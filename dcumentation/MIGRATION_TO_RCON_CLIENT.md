# Миграция на rcon-client

## Обзор изменений

Проект был обновлен с устаревшей библиотеки `minecraft-server-util` на современную `rcon-client` для работы с Minecraft RCON.

## Установка зависимостей

После обновления кода выполните:

```bash
# Установка новых зависимостей
bun install
```

## Основные изменения

### 1. Замена библиотек
- **Удалено**: `minecraft-server-util`, `minecraft-protocol`
- **Добавлено**: `rcon-client@^4.2.3`

### 2. Обновленный MinecraftService

#### Новые возможности:
- Более стабильное RCON подключение
- Улучшенная обработка ошибок
- Оптимизированные повторные попытки
- Лучшая совместимость с современными версиями Minecraft

#### Изменения в методах:

**checkServerStatus():**
- Теперь использует RCON команды `list` и `version` для получения информации
- Более надежная проверка доступности сервера

**executeRconCommand():**
- Упрощенное подключение через `rcon-client`
- Автоматическое управление соединением
- Улучшенное логирование

**addToWhitelist() / removeFromWhitelist():**
- Расширенная проверка успешности команд
- Поддержка различных форматов ответов сервера
- Более точное определение результата операции

**getWhitelistedPlayers():**
- Улучшенный парсинг ответа команды `whitelist list`
- Поддержка различных версий Minecraft
- Более надежное извлечение списка игроков

### 3. TypeScript типы

Добавлены типы для `rcon-client` в `src/types/rcon-client.d.ts`:
- Полная типизация для всех методов
- Интерфейс `RconOptions`
- Класс `Rcon` с типизированными методами

### 4. Конфигурация

Обновлен `tsconfig.json`:
- Добавлена поддержка пользовательских типов
- Настроен `typeRoots` для включения `src/types`

## Совместимость

### Поддерживаемые версии Minecraft:
- Minecraft 1.16+
- Все современные версии сервера
- Bukkit, Spigot, Paper, Fabric, Forge

### Требования к серверу:
- Включенный RCON в `server.properties`
- Правильно настроенные `rcon.port` и `rcon.password`
- Доступность RCON порта для подключения

## Тестирование

После обновления рекомендуется протестировать:

1. **Подключение к серверу:**
   ```bash
   bun run dev
   # Проверить логи подключения к RCON
   ```

2. **Команды whitelist:**
   - Добавление игрока в whitelist
   - Удаление игрока из whitelist
   - Получение списка whitelist

3. **Обработка ошибок:**
   - Поведение при недоступном сервере
   - Повторные попытки подключения
   - Корректное закрытие соединений

## Устранение неполадок

### Ошибки подключения:
1. Проверьте настройки RCON в `server.properties`
2. Убедитесь, что порт RCON доступен
3. Проверьте правильность пароля RCON

### Проблемы с командами:
1. Проверьте версию Minecraft сервера
2. Убедитесь, что whitelist включен на сервере
3. Проверьте логи для детальной информации об ошибках

### Отладка:
Включите подробное логирование в настройках для диагностики проблем.

## Преимущества обновления

- **Стабильность**: Более надежная работа с RCON
- **Производительность**: Оптимизированные подключения
- **Совместимость**: Поддержка новых версий Minecraft
- **Безопасность**: Улучшенная обработка соединений
- **Поддержка**: Активно поддерживаемая библиотека