/**
 * –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Minecraft –Ω–∏–∫–Ω–µ–π–º–æ–≤
 * –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª–∞—Ö Mojang
 */

/**
 * –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∏–∫–Ω–µ–π–º–∞
 */
export interface ValidationResult {
  isValid: boolean;
  error?: string;
  details?: string;
}

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∏–∫–Ω–µ–π–º–∞ Minecraft —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º Mojang
 * 
 * –ü—Ä–∞–≤–∏–ª–∞:
 * - –î–ª–∏–Ω–∞: –æ—Ç 3 –¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤
 * - –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã (A-Z, a-z), —Ü–∏—Ñ—Ä—ã (0-9), –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ (_)
 * - –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: ^[a-zA-Z0-9_]{3,16}$
 * 
 * @param nickname –ù–∏–∫–Ω–µ–π–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
 * @returns –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏
 */
export function validateMinecraftNickname(nickname: string): ValidationResult {
  // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
  const trimmedNickname = nickname.trim();
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É
  if (!trimmedNickname) {
    return {
      isValid: false,
      error: '–ù–∏–∫–Ω–µ–π–º –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º',
      details: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫–Ω–µ–π–º.'
    };
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã - —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
  if (trimmedNickname.length < 3) {
    return {
      isValid: false,
      error: '–ù–∏–∫–Ω–µ–π–º —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π',
      details: `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–∞: 3 —Å–∏–º–≤–æ–ª–∞. –í–∞—à –Ω–∏–∫–Ω–µ–π–º —Å–æ–¥–µ—Ä–∂–∏—Ç ${trimmedNickname.length} —Å–∏–º–≤–æ–ª${trimmedNickname.length === 1 ? '' : trimmedNickname.length < 5 ? '–∞' : '–æ–≤'}.`
    };
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã - —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
  if (trimmedNickname.length > 16) {
    return {
      isValid: false,
      error: '–ù–∏–∫–Ω–µ–π–º —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π',
      details: `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–∞: 16 —Å–∏–º–≤–æ–ª–æ–≤. –í–∞—à –Ω–∏–∫–Ω–µ–π–º —Å–æ–¥–µ—Ä–∂–∏—Ç ${trimmedNickname.length} —Å–∏–º–≤–æ–ª–æ–≤.`
    };
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
  const validPattern = /^[a-zA-Z0-9_]+$/;
  if (!validPattern.test(trimmedNickname)) {
    // –ù–∞–π–¥—ë–º –ø–µ—Ä–≤—ã–π –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–∏–º–≤–æ–ª –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    const invalidChars = trimmedNickname.split('').filter(char => !/[a-zA-Z0-9_]/.test(char));
    const uniqueInvalidChars = [...new Set(invalidChars)];
    
    return {
      isValid: false,
      error: '–ù–∏–∫–Ω–µ–π–º —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã',
      details: `–†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã (A-Z, a-z), —Ü–∏—Ñ—Ä—ã (0-9) –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ (_).\n` +
               `–ù–∞–π–¥–µ–Ω—ã –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã: ${uniqueInvalidChars.map(char => `"${char}"`).join(', ')}`
    };
  }
  
  // –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
  return {
    isValid: true
  };
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
 * 
 * @param result –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 * @returns –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
 */
export function formatValidationError(result: ValidationResult): string {
  if (result.isValid) {
    return '';
  }
  
  let message = `‚ùå ${result.error}\n\n`;
  
  if (result.details) {
    message += `${result.details}\n\n`;
  }
  
  message += 'üìã **–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –Ω–∏–∫–Ω–µ–π–º–∞ Minecraft:**\n';
  message += '‚Ä¢ –î–ª–∏–Ω–∞: –æ—Ç 3 –¥–æ 16 —Å–∏–º–≤–æ–ª–æ–≤\n';
  message += '‚Ä¢ –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã (A-Z, a-z), —Ü–∏—Ñ—Ä—ã (0-9), –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ (_)\n';
  message += '‚Ä¢ –ü—Ä–∏–º–µ—Ä—ã –≤–∞–ª–∏–¥–Ω—ã—Ö –Ω–∏–∫–Ω–µ–π–º–æ–≤: Steve, Notch, Alex_123, Player1\n\n';
  message += '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º:';
  
  return message;
}

/**
 * –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏
 */
export const VALIDATION_EXAMPLES = {
  valid: ['Steve', 'Notch', 'Alex_123', 'Player1', 'abc', 'Test_User_2024'],
  invalid: {
    tooShort: ['ab', 'x', '12'],
    tooLong: ['ThisNameIsWayTooLong17', 'VeryLongNicknameExample'],
    invalidChars: ['alex!', '–Ω–∏–∫', 'player@home', 'test-user', 'name with spaces']
  }
};